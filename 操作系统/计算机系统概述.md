## 计算机系统概述
计算机由处理器、存储器和输入输出部件组成，每类部件有一个或多个模块，部件通过总线相连，以执行程序。
计算机总共有四个主要的结构化部件：
1. 处理器：控制计算机的操作，执行数据处理功能。当只有一个处理器时，通常指中央处理器
2. 内存：存储数据和程序。此类存储器通常是易失性的。相对于此的是磁盘存储器，内容不会出现丢失
3. 输入/输出IO模块：在计算机和外部环境之间移动数据
4. 系统总线：为处理器、内存和输入/输出模块间提供通信的设施

处理器的一种功能是和存储器交换数据，为此使用两个内部寄存器：存储器地址寄存器（MAR，用于确定下一次读写的存储器地址）、存储器缓冲寄存器（MBR，存放要写入存储器的数据或者从存储器中读取的数据）
同理存在输入/输出地址寄存器（I/O AR，用于确定一个特定的输入/输出设备）以及输入/输出缓冲寄存器（I/O BR，用于在输入/输出模块和处理器间交换数据）

![模块图](https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimages0.cnblogs.com%2Fblog2015%2F413625%2F201508%2F262100332343627.png&refer=http%3A%2F%2Fimages0.cnblogs.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1650191896&t=e23e03c5bc9530bd7f92e2ccdb9840ad "模块图")

内存模块由一组单元组成，这些单元由顺序编号的地址定义。每个单元包含一个二进制数，可以解释为一个指令或数据。输入/输出模块在外部设备与处理器和存储器之间传送数据。输入/输出模块包含内存缓冲区，用于临时保存数据，直到它们被发送出去。

处理器执行的程序是由一组保存在存储器中的指令组成的。按最简单的形式，指令处理包括两步：处理器从存储器中一次读一条指令，然后执行每条指令。程序执行是由不断重复的取指令和执行指令的过程组成的。
一个单一的指令需要的处理称为一个指令周期，指令周期包括取指阶段与执行阶段。

在每个指令周期开始时，处理器从存储器中取一条指令。在典型的处理器中，程序计数器（简称PC）保存下一次要取的指令地址。除非有其他情况，否则处理器在每次取指令后总是递增PC便于能够按顺序取得下一条指令。
取到的指令被放置在处理器的一个寄存器中，这个寄存器称为指令寄存器（简称IR）。指令中包含确定处理器将要执行的操作的位，处理器解释指令并执行对应的操作，操作可分为四类：处理器-存储器、处理器-I/O、数据处理、控制。

![指令周期实例](http://mms2.baidu.com/it/u=3051261032,3357611746&fm=253&app=138&f=JPEG&fmt=auto&q=75?w=498&h=500 "指令周期实例")

事实上所有计算机都提供了允许其他模块中断处理器正常处理过程的机制：
1. 程序中断：在某些条件下由指令执行的结果产生
2. 时钟中断：由处理器内部的计时器产生，允许操作系统以一定规律执行函数
3. IO中断：由IO控制器产生，用于发信号通知一个操作的正常完成或各种错误条件
4. 硬件失效中断：掉电或存储器奇偶校验错误之类的故障产生

![中断控制流](http://mms2.baidu.com/it/u=1771483646,2947387891&fm=253&app=138&f=PNG&fmt=auto&q=75?w=772&h=500 "中断控制流")

利用中断功能，处理器可以在IO操作的执行过程中执行其他指令。用户程序到达系统调用WRITE处，但涉及的IO程序仅包括准备代码和真正的IO命令。在这些为数不多的几条指令执行后，控制返回到用户程序。在这期间，外部设备忙于从计算机存储器接收数据并打印。这种IO操作和用户程序中的指令执行是并发的。
当外部设备做好服务的准备时（准备好从处理器接收更多的数据时），该外部设备的IO模块给处理器发送一个中断请求信号。这时处理器会做出响应，暂停当前程序的处理，转去处理服务于特定IO设备的程序，这个程序称为中断处理程序。在对该设备的服务响应完成后，处理器回复原先的执行。

<img src="D:\Project\IT-notes\操作系统\img\中断时序.png" style="width:400px;height:600px;" />

中断激活了很多事件，包括处理器硬件中的事件及软件中的事件。当IO设备完成一次IO操作时，发生下列硬件事件：
1. 设备给处理器发出一个中断信号
2. 处理器在响应中断前结束当前指令的执行
3. 处理器对中断进行测定，确定存在未响应的中断，并给提交中断的设备发送确认信号，确认信号允许该设备取消它的中断信号
4. 处理器需要为把控制权转移到中断程序中去做准备。首先需要保存从中断点恢复当前程序所需要的信息，至少包括程序状态字PSW和保存在程序计数器PC中的下一条要执行的指令地址，它们被压入系统控制栈中
5. 处理器把响应此中断的中断处理程序入口地址装入程序计数器中
6. 被中断程序相关的程序计数器和PSW被保存到系统栈中，还有一些其他信息被当作正在执行程序的状态的一部分，特别是处理器寄存器的内容
7. 中断处理程序开始处理中断，包括检查与IO操作相关的状态信息或其他引起中断的事件，还可能包括给IO设备发送附加命令或应答
8. 当中断处理结束后，被保存的寄存器值从栈中释放并恢复到寄存器中
9. 从栈中恢复PSW和程序计数器的值

<img src="D:\Project\IT-notes\操作系统\img\简单中断处理.jpg" style="width:600px;height:600px;" />

<img src="D:\Project\IT-notes\操作系统\img\中断变化.jpg" style="width:600px;height:600px;" />

处理多个中断有两种方法：
1. 当正在处理一个中断时，禁止再发生中断（处理器对任何中断请求信号不予理睬，若期间发生中断，通常对中断进行挂起。当处理器再次允许中断时，处理器再检查）
2. 定义中断优先级，允许高优先级的中断打断低优先级的中断处理程序的运行

提高存储读写性能：
1. 磁盘成簇写：即采用次数少、数据量大的传输方式，而不是次数多、数据量少的传输方式
2. 一些注定要写出的数据也许会在写一次存储到磁盘之前被程序访问，此情况下，数据能够循序地从软件设置的磁盘高速缓存中取出

<img src="D:\Project\IT-notes\操作系统\img\高速缓存和内存.png" style="width:600px;height:400px;" />

高速缓存包含一部分内存数据的副本。当处理器试图读取存储器中的一个字节或字时，要进行一次检查以确定这个字是否再高速缓存中。如果在，则该字节从高速缓存传递给处理器；如果不在，则先将由固定数目的字节组成的一块内存数据读入高速缓存，然后该字节从高速缓存传递给处理器。由于访问局部性现象的存在，当一块数据被取入高速缓存以满足一次存储器访问时，很可能紧接着的多次访问的数据是该块中的其他字节

影响高速缓存效率的两个方面：
1. 高速缓存的大小
2. 块的大小，即高速缓存与内存间的数据交换单位大小，存在局部性原理的影响
3. 映射函数：确定块将占据哪个高速缓存单元
4. 置换算法：当高速缓存单元被占满，置换算法要选择置换那些在不久的将来被访问的可能性最小的块
5. 写策略：高速缓存中的块被修改，则需要被换出之前写回内存，可在更新后就发生写操作，也可在被置换后发生写操作

直接内存存取DMA与可编程IO模块、中断驱动IO的区别：当处理器要读或写一块数据，会给DMA模块产生一条命令（询问是否请求一次读写、涉及的IO设备地址、开始读写的存储器单元、需要读写次数），随后处理器继续其他工作，读写操作委托给DMA模块，由DMA模块直接和存储器进行交互。只有传送开始与结束时DMA模块才会与处理器进行信号交流。

**DMA模块与处理器存在总线竞争的关系，因为DMA与存储器交互需要通过总线，该关系并非中断**

