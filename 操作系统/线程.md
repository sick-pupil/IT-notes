## 1. 进程与线程
**资源所有权**：一个进程包括一个存放进程映像的虚拟地址空间，进程映像是程序、数据、栈和进程控制块中定义的属性的集合。一个进程总是拥有对资源的控制或所有权，这些资源包括内存、IO通道、IO设备和文件等。操作系统提供保护功能，以防止进程之间发生不必要的与资源相关的冲突

**调度/执行**：一个进程沿着可以通过一个或多个程序的执行路径执行。其执行过程可能与其他进程的执行过程交替进行。因此，一个进程具有一个执行状态和一个被分配的优先级，它是一个可被操作系统调度和分派的实体

### 1. 多线程
**多线程**是指操作系统在单个进程内支持多个并发执行路径的能力。每个进程中只有一个线程在执行的传统方法被称为**单线程方法**。

<img src="D:\Project\IT-notes\操作系统\img\线程和进程.png" style="width:600px;height:400px;" />

在多线程环境中，进程被定义成资源分配的单位和一个被保护的单位。与进程相关联的有：
* 存放进程映像的虚拟地址空间
* 受保护地对处理器、其他进程（用于进程间通信）、文件和IO资源（设备和通道）的访问

在一个进程中，可能有一个或多个线程，每个线程有：
* 线程执行状态
* 在未运行时保存的线程上下文
* 一个执行栈
* 用于每个线程局部变量的静态存储空间
* 与进程内的其他线程共享的对进程的内存和资源的访问

在**单线程进程模型**中，进程的表示包括它的进程控制块和用户地址空间，以及在进程执行中管理调用/返回行为的用户栈和内核栈
在**多线程进程模型**中，进程仍然只有一个与之关联的进程控制块和用户地址空间，但每个线程都有一个独立的栈，还有独立的控制块用于包含寄存器值、优先级和其他与线程相关的状态信息。

进程中的所有线程共享该进程的状态和资源，它们驻留在同一块地址空间中，并且可以访问到相同的数据

<img src="D:\Project\IT-notes\操作系统\img\单线程和多线程进程模型.png" style="width:600px;height:400px;" />

与进程相比，线程拥有一定的性能优势：
1. 在一个已有进程中创建一个新线程与创建一个全新进程所需的时间要少许多
2. 终止一个线程比终止一个进程花销少
3. 同一进程内的线程切换比进程间切换花销少
4. 线程提高了不同执行程序间通信的效率

### 2. 线程功能特性
**线程状态**：和进程一样，线程的关键状态有运行态、就绪态和阻塞态（若进程被换出，则它的所有线程由于共享同一内存地址空间，因此都被换出）

与线程状态改变的基本操作：**派生、阻塞、解除阻塞、结束**

**线程同步**：一个进程中的所有线程共享同一个地址空间和诸如打开的文件之类的其他资源。一个线程对资源的任何修改都会影响同一个进程中其他线程的环境，因此需要同步线程的活动

### 3. 线程分类
线程可以分为**用户级线程**和**内核级线程**

**用户级线程**：在一个纯粹的用户级线程软件中，有关线程管理的所有工作都由应用程序完成，内核意识不到线程的存在
**内核级线程**：在一个纯粹的内核级线程软件中，有关线程管理的所有工作都是由内核完成的，应用程序部分没有进程线程管理的代码，只有一个到内核线程设施的应用程序编程接口

<img src="D:\Project\IT-notes\操作系统\img\用户级线程和内核级线程.png" style="width:500px;height:300px;" />

**用户级线程的优点**：
1. 由于所有线程管理数据结构都在一个进程的用户地址空间中，线程切换不需要内核态特权，因此进程不需要为了线程管理而切换到内核态，这节省了两次状态切换的开销
2. 调度可以是应用程序相关的。一个应用程序可能更适合简单的轮转调度算法，而另一个应用程序可能更适合基于优先级的调度算法。可以做到为应用程序量身定做调度算法
3. 用户级线程可以在任何操作系统中运行，不需要对底层内核进行修改以支持用户级线程。线程库是一组供所有程序共享的应用程序级别的函数

**用户级线程的缺点**：
1. 在典型的操作系统中，许多系统调用都会引起阻塞。因此，当用户级线程执行一个系统调用时，不仅这个线程会被阻塞，进程中的所有线程都会被阻塞
2. 在纯粹的用户级线程策略中，一个多线程应用程序不能利用多处理技术。内核一次只把一个进程分配给一个处理器，因此一次进程中只有一个线程可以执行

**内核级线程的优点**：
1. 内核可以同时把同一个进程中的多个线程调度到多个处理器；如果进程中的一个线程被阻塞，内核可以调度同一个进程中的另一个线程
2. 内核例程自身可以使用多线程

**内核级线程的缺点**：
1. 在把控制从一个线程传送到同一个进程内的另一个线程时，需要到内核的状态切换

